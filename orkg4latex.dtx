% \iffalse meta-comment
% !TEX program  = pdfLaTeX
%<*internal>
\iffalse
%</internal>
%<*readme>
----------------------------------------------------------------
orkg4latex --- description text
E-mail: you@your.domain
Released under the LaTeX Project Public License v1.3c or later
See http://www.latex-project.org/lppl.txt
----------------------------------------------------------------

Some text about the package: probably the same as the abstract.
%</readme>
%<*internal>
\fi
\def\nameofplainTeX{plain}
\ifx\fmtname\nameofplainTeX\else
  \expandafter\begingroup
\fi
%</internal>
%<*install>
\input docstrip.tex
\keepsilent
\askforoverwritefalse
\preamble
----------------------------------------------------------------
orkg4latex --- description text
E-mail: you@your.domain
Released under the LaTeX Project Public License v1.3c or later
See http://www.latex-project.org/lppl.txt
----------------------------------------------------------------

\endpreamble
\postamble

Copyright (C) 2009 by You <you@your.domain>

This work may be distributed and/or modified under the
conditions of the LaTeX Project Public License (LPPL), either
version 1.3c of this license or (at your option) any later
version.  The latest version of this license is in the file:

http://www.latex-project.org/lppl.txt

This work is "maintained" (as per LPPL maintenance status) by
You.

This work consists of the file  orkg4latex.dtx
and the derived files           orkg4latex.ins,
                                orkg4latex.pdf and
                                orkg4latex.sty.

\endpostamble
\usedir{tex/latex/orkg4latex}
\generate{
  \file{\jobname.sty}{\from{\jobname.dtx}{package}}
}
%</install>
%<install>\endbatchfile
%<*internal>
\usedir{source/latex/orkg4latex}
\generate{
  \file{\jobname.ins}{\from{\jobname.dtx}{install}}
}
\nopreamble\nopostamble
\usedir{doc/latex/orkg4latex}
\generate{
  \file{README.txt}{\from{\jobname.dtx}{readme}}
}
\ifx\fmtname\nameofplainTeX
  \expandafter\endbatchfile
\else
  \expandafter\endgroup
\fi
%</internal>
%<*package>
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{orkg4latex}[2009/10/06 v1.0 description text]
%</package>
%<*driver>
\documentclass{ltxdoc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{\jobname}
\usepackage[numbered]{hypdoc}
\EnableCrossrefs
\CodelineIndex
\RecordChanges
\begin{document}
  \DocInput{\jobname.dtx}
\end{document}
%</driver>
% \fi
%
%\GetFileInfo{\jobname.sty}
%
%\title{^^A
%  \textsf{orkg4latex} --- description text\thanks{^^A
%    This file describes version \fileversion, last revised \filedate.^^A
%  }^^A
%}
%\author{^^A
%  You\thanks{E-mail: you@your.domain}^^A
%}
%\date{Released \filedate}
%
%\maketitle
%
%\changes{v1.0}{2009/10/06}{First public release}
%
%\DescribeMacro{\examplemacro}
% Some text about an example macro called \cs{examplemacro}, which
% might have an optional argument \oarg{arg1} and mandatory one
% \marg{arg2}.
%
%\StopEventually{^^A
%  \PrintChanges
%  \PrintIndex
%}
%
%    \begin{macrocode}
%<*package>
%    \end{macrocode}
%
%\begin{macro}{\orkgannotations}
%\changes{v1.0}{2009/10/06}{Some change from the previous version}
%    \begin{macrocode}

% fix the spaces after environment 
\def\useignorespacesandallpars#1\ignorespaces\fi{%
#1\fi\ignorespacesandallpars}

\makeatletter
\def\ignorespacesandallpars{%
  \@ifnextchar\par
    {\expandafter\ignorespacesandallpars\@gobble}%
    {}%
}
\makeatother

\directlua { 
  ORKG = require('orkg4latex')
}

\newcommand{\ORKGaddproperty}[2][]{%
  \directlua{ORKG:add_property_to_list("\luaescapestring{\unexpanded{#2}}")}
  % make a new command with name given by #1
  \expandafter\newcommand\csname #2\endcsname[2][]{%
    \directlua{%
      local property_type = "\luaescapestring{\unexpanded{#2}}"
      local property_URI = "\luaescapestring{\unexpanded{#1}}"
      local content = "\luaescapestring{\unexpanded{##2}}"
      local belongs_to_contribution = "\luaescapestring{\unexpanded{##1}}"
      print(belongs_to_contribution)
      ORKG.XMP:add_annotation(belongs_to_contribution, property_type, property_URI, content, 'annotation-id')
    }
    ##2%
  }
}

\newenvironment{background}
  {%
    \ignorespaces
    \directlua{
      ORKG.remember_body()
      ORKG.register_environment('background')
    }
  }{%
    \directlua{
      ORKG.stop_remember_body()
      ORKG.add_background(ORKG.get_environment_body())
    }
    \ifhmode\unskip\fi
    \aftergroup\useignorespacesandallpars
  }

\newenvironment{contribution}
  {%
    \ignorespaces
    \directlua{
      ORKG.remember_body()
      ORKG.register_environment('contribution')
    }
  }{%
    \directlua{
      ORKG.stop_remember_body()
      ORKG.add_contribution(ORKG.get_environment_body())
    }
    \ifhmode\unskip\fi
    \aftergroup\useignorespacesandallpars
  }

\newenvironment{methods}
  {%
    \ignorespaces
    \directlua{
      ORKG.remember_body()
      ORKG.register_environment('methods')
    }
  }{%
    \directlua{
      ORKG.stop_remember_body()
      ORKG.add_methods(ORKG.get_environment_body())
    }
    \ifhmode\unskip\fi
    \aftergroup\useignorespacesandallpars
  }

\newenvironment{problem statement}
  {%
    \ignorespaces
    \directlua{
      ORKG.remember_body()
      ORKG.register_environment('problem statement')
    }
  }{%
    \directlua{
      ORKG.stop_remember_body()
      ORKG.add_problem_statement(ORKG.get_environment_body())
    }
    \ifhmode\unskip\fi
    \aftergroup\useignorespacesandallpars
  }

\newenvironment{results}
  {%
    \ignorespaces
    \directlua{
      ORKG.remember_body()
      ORKG.register_environment('results')
    }
  }{%
    \directlua{
      ORKG.stop_remember_body()
      ORKG.add_results(ORKG.get_environment_body())
    }
    \ifhmode\unskip\fi
    \aftergroup\useignorespacesandallpars
  }

%    \end{macrocode}
%\end{macro}
%
%    \begin{macrocode}
%</package>
%    \end{macrocode}
%\Finale